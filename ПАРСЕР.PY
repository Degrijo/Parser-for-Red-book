import requests
from bs4 import BeautifulSoup
import re


def get_html(url, useragent=None, proxy=None):
    print('get_html')
    r = requests.get(url, headers=useragent, proxies=proxy, cookies={'serverPW': '40ba9118730170106e6a8a2f0e316c88a2c55c2c6a4456e3979e2e3b7babce01a%3A2%3A%7Bi%3A0%3Bs%3A8%3A%22serverPW%22%3Bi%3A1%3BN%3B%7D'})
    return r.text   


def translate(text):
    key = 'trnsl.1.1.20181208T105434Z.0f39ab1008611643.4cf37073d9f2b4a1b126c71a5caa228b4ece1309'
    url = 'https://translate.yandex.net/api/v1.5/tr.json/translate?'
    r = requests.post(url, data={'key': key, 'text': text, 'lang': 'ru-en'})
    return eval(r.text)['text'][0]
    

def get_and_set_data(html, year, temp_length_stem, temp_length_inf, districts, parts, template): 
    soup = BeautifulSoup(html, 'lxml')
    try:
        name = str(soup.find('td', valign = 'top', style = 'padding-left:10px'))
        name = name.lower()
        names = re.split('<br/>', name[43:-5])
        idtf = re.sub(' \(.*\)', '', names[1])
        idtf = re.sub('[ -]', '_', idtf)
        idtf = re.sub('[,.:;^&%$#!/*]','', idtf)
        print('get_pict')
        a = soup.find('img', style="border:1px solid #dedede;")['src']
        r = requests.get('http://redbook.minpriroda.gov.by'+a)
        open('concept_'+idtf+'.jpg', 'wb').write(r.content)
        sec_cat = soup.find('a', href="/hints/cats.html", onclick='return _help("cats");', target="_blank").text
        template = template.replace('temp_sec_cat', sec_cat)
        paragraphs = soup.find_all('p')[6:8] +[soup.find_all('p')[9]] + soup.find_all('p')[11:16]
        paragraphs = [i.text.strip() for i in paragraphs]
        for i in range(len(paragraphs)):
            paragraphs[i] = paragraphs[i].replace("\n", '')
            paragraphs[i] = paragraphs[i].replace(':', ': ')
        template = template.replace("temp_idtf", idtf)
        template = template.replace("temp_name_ru", names[0])
        template = template.replace("temp_name_lat", names[1])
        template = template.replace("temp_name_bel", names[2])
        for i in range(len(paragraphs)):
            template = template.replace('temp_paragraph_'+str(i), paragraphs[i])
        for i in range(2):
            template = template.replace("temp_length_stem["+str(i)+"]", temp_length_stem[i])
            template = template.replace("temp_length_inf["+str(i)+"]", temp_length_inf[i])
        districts = [translate(i)+'_district' for i in districts]
        districts = [i.replace(' ', '_') for i in districts]
        if len(districts) == 0:
            template = template.replace("temp_distr", "Republic_of_Belarus")
        else:
            template = template.replace("temp_distr", ';;->'.join(districts))
        parts = [[re.sub('[ -]', '_', translate(j)) for j in parts[i]] for i in range(6)]
        parts = [[j.replace('[(),.:;^&%$#!/*]','') for j in parts[i]] for i in range(6)]
        for i in range(len(parts)):
            if len(parts[i]) == 0:
                template = template.replace("temp_part"+'['+str(i)+'];', '')
            else:
                template = template.replace("temp_part"+'['+str(i)+']', ';'.join(parts[i]))
        template = template.replace("temp_year", year)
        with open("concept_" + idtf + '.scs', 'w', encoding='UTF-8') as file:
            file.write(template)
        print('done')
    except:
        print('error')


template = open("template.txt", encoding='UTF-8')
text = template.read()
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=38'), '1981', ['40', '60'], ['1.5', '2'], ['Витебский', 'Городокский', 'Лепельский', 'Лиозненский', 'Дятловский', 'Ивьевский', 'Ошмянский', 'Свислочский', 'Щучинский', 'Березовский', 'Брестский', 'Ганцевичский', 'Ивановский', 'Ивацевичский', 'Кобринский', 'Лунинецкий', 'Ляховичский', 'Малоритский', 'Пинский', 'Пружанский', 'Столинский', 'Житковичский', 'Калинковичский', 'Мозырский', 'Октябрьский', 'Светлогорский', 'Речицкий', 'Хойникский', 'Борисовский', 'Воложинский', 'Любанский', 'Пуховичский', 'Слуцкий', 'Стародорожский', 'Столбцовский', 'Узденский', 'Белыничский', 'Бобруйский', 'Кировский', 'Кличевский', 'Костюковичский', 'Осиповичский', 'Чериковский', 'Горецкий', 'Беловежская пуща', 'Гродненский', 'Мозырьский', 'Пинский', 'Ивановский', 'Светлогорский', 'Осиповичский', 'Хойникский', 'Могилевский'], [['прямостоящий'], ['длинный', 'разветвленный', 'горизонтальный'], ['непарно перисто рассеченный', 'зубчатый', 'цельный'], ['лилово-розовый', 'светло-фиолетовый', 'белый'], ['верхушечная кисть'], ['узкий', 'стручочек']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=39'), '1981', ['100', '120'], ['5', '10'], ['Борисовский', 'Вилейский', 'Воложинский', 'Логойский', 'Любанский', 'Минский', 'Мядельский', 'Солигорский', 'Бешенковичский', 'Витебский', 'Городокский', 'Докшицкий', 'Лиозненский', 'Оршанский', 'Сенненский', 'Ивацевичский', 'Столинский', 'Гродненский', 'Беловежская пуща', 'Могилевский', 'Горецкий'], [['прямостоячий', 'шершавый', 'белые волоски', 'ветвистый'], [], ['тонкий', 'крупный', 'сердцевидный', 'короткоопушенный', 'пильчато-зубчатый', 'очередной', 'супротивный'], ['душистый', 'лиловый', 'фиолетовый', 'белый лепесток'], ['негустой', 'метельчатый'], ['стручочек', 'повислый', 'уплощенный', 'эллиптический', 'заостренный', 'пленчатая серебристо-перламутровая перегородка']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=40'), '1993', ['30', '80'], ['3.4', '7.2'], ['Брестский', 'Ивацевичский', 'Кобринский', 'Малоритский', 'Столинский', 'Браславский', 'Докшицкий', 'Лепельский', 'Лиозненский', 'Россонский', 'Шумилинский', 'Борисовский', 'Вилейский', 'Воложинский', 'Крупский', 'Минский', 'Мядельский', 'Калинковичский', 'Мозырский', 'Бобруйский', 'Кировский', 'Кличевский', 'Гродненский', 'Туровский', 'Жлобинский', 'Глусский', 'Кличевский', 'Лельчицкий'], [['восходящий'], [], ['мелкий', 'эллиптический', 'продолговато-яйцевидный', 'цельнокрайний', 'голый', 'матово-зеленый', 'сизый', 'короткий черешок'], ['мелкий', 'без прицветника'], ['рыхлый', 'сережка'], ['узкий', 'одногнездный', 'двустворчатый', 'коробочка']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=41'), '2006', ['10', '30'], ['0.3', '0.6'], ['Столинский', 'Верхнедвинский', 'Витебский', 'Глубокский', 'Городокский', 'Лепельский', 'Миорский', 'Полоцкий', 'Россонский', 'Шумилинский', 'Свислочский', 'Борисовский', 'Мядельский', 'Слуцкий', 'Белыничский', 'Кличевский', 'Рогачевский', 'Кличевский', 'Кировский', 'Горецкий'], [['тонкий', 'нитевидный', 'стелющийся'], [], ['очередный', 'кожистый', 'мелкий', 'продолговато-яйцевидный', 'заостренный', 'завороченный край', 'темно-зеленый', 'сизый'], ['одиночный', 'голая длинная цветоножка', 'венчик глубокочетырехраздельный с розово-красными лепестками'], [], ['округлый', 'мелкий', 'темно-красный', 'ягода']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=42'), '1981', ['60', '200'], ['10', '13'], ['Ельский', 'Житковичский', 'Лельчицкий', 'Ляховичский'], [['щетинисто-волосистый', 'молодой', 'побег'], [], ['очередной', 'короткий черешок'], ['крупный', 'воронковидный', 'оранжевый', 'желтый', 'сильный запах'], ['малоцветковый', 'зонтиковидный', 'щиток'], ['продолговатый', 'сухой', 'растрескивающийся', 'коричневый', 'коробочка']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=43'), '2006', ['8', '12'], ['0.12', '0.25'], ['Барановичский', 'Брестский', 'Ивацевичский', 'Каменецкий', 'Малоритский', 'Пружанский', 'Браславский', 'Докшицкий', 'Лепельский', 'Полоцкий', 'Россонский', 'Чашникский', 'Житковичский', 'Лельчицкий', 'Мозырский', 'Речицкий', 'Гродненский', 'Островецкий', 'Ошмянский', 'Слонимский', 'Сморгонский', 'Вилейский', 'Воложинский', 'Дзержинский', 'Крупский', 'Логойский', 'Минский', 'Мядельский', 'Смолевичский', 'Белыничский', 'Мстиславский', 'Осиповичский', 'Чериковский'], [[], ['тонкий', 'ветвящийся'] ,['кожистый', 'округлый', 'мелко-пильчато-городчатый', 'темно-зеленый'] ,['одиночный', 'крупный', 'поникающий'] ,[], ['прямостоячий', 'шаровидный', 'коробочка']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=44'), '1981', ['15', '25'], ['5', '10'], ['Пуховичский', 'Витебский', 'Глубокский', 'Докшицкий', 'Лиозненский', 'Полоцкий', 'Шумилинский', 'Каменецкий'], [[], ['короткое'], ['продолговато-обратнояйцевидный', 'широкий черешок', 'зубчатый', 'мягкоопушенный'], ['светло-желтый', 'пятичленный'], ['зонтиковидный'], ['многосемянной', 'коробочка']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=45'), '2006', ['45', '120'], ['4.5', '10.5'], ['Житковичский', 'Горецкий'], [['многочисленный', 'прямостоячий', 'дудчатый', 'густоволосистый', 'голый'], ['толстый', 'многоглавый'], ['чешуевидный', 'сидячий', 'черешчатый', 'эллиптический', 'закругленный', 'заостренный'], ['раздельнополый'], ['щитковидный', 'верхушечный'], ['трехгнездный', 'трехлопастный', 'шаровидный', 'коробочка']], text)
#get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=46'), '1981', ['15', '30'], ['1.5', '5'], ['Лельчицкий'], [['небольшой', 'разветвленный'], [], ['сидячий', 'очередной', 'мелкий', 'кожистый', 'лопатчатый', 'удлиненно-обратнояйцевидный', 'кругловатый', 'выемчатый на верхушке'], ['розовый', 'душистый'], ['головчатый', 'верхушечный'], ['желто-бурый', 'ягода']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=47'), '2006', ['20', '35'], ['4', '10'], ['Хойникский', 'Брагинский'], [['прямостоячий', 'бороздчатый', 'с редким опушением', 'железистые волоски'], ['утолщенный', 'веретеновидный'], ['суккулентный', 'полушаровидные розетки', 'обратнояйцевидный', 'расширенный', 'заостренный', 'железисто-волосистый','очередной', 'расставленный', 'продолговато-ланцетный', 'опушенный'], [], ['рыхлый', 'щитковидный', 'чашечка', 'зеленовато-желтые лепестки', 'линейный', 'длинно-железистый'], ['листовка', 'многосемянной', 'продолговато-яйцевидный', 'длинный прямой носик']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=48'), '1981', ['10', '35'], ['3', '6'], ['Брагинский', 'Слуцкий', 'Новогрудский', 'Гродненский', 'Слонимский', 'Гривденский', 'Могилевский', 'Мядельский', 'Верхнедвинский', 'Быховский', 'Гомельский', 'Горецкий', 'Минский', 'Оршанский', 'Рогачевский', 'Сенненский', 'Гродненский', 'Докшицкий', 'Лепельский', 'Пружанский'], [['одиночный', 'несколько', 'прямостоячий', 'ползучий побег', 'дерновинка'], [], ['светло-зеленый', 'голый', 'очередной', 'удлиненно-ланцетный', 'сидячий'], ['ярко-желтый', 'оранжевые точки', 'бородавочки'], [], ['2-гнездный', 'двурогий', 'продолговато-овальный', 'коробочка']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=49'), '1981', ['20', '40'], ['1.3', '1.5'], ['Браславском', 'Гродненский', 'Кореличский', 'Новогрудский', 'Свислочский', 'Слонимский', 'Молодечненский', 'Столбцовский', 'Барановичский', 'Каменецкий', 'Оршанский' , 'Несвижский' , 'Минский', 'Беловежская пуща'], [['прямостоячий'], ['много', 'мелкий', 'клубенек'], ['прикорневая розетка', 'простой', 'округло-почковидный', 'цельный', 'крупногородчатый', 'мало', 'клиновидное основание', 'узкие лопасти'], ['беловатый'], ['немногоцветковый', 'метельчатый'], ['коробочка']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=50'), '1981', ['5', '10'], ['0.4', '0.5'], ['Брестский', 'Житковичский', 'Малоритский', 'Пинский', 'Верхнедвинский', 'Миорский', 'Поставский', 'Ушачский', 'Житковичский', 'Пинский', 'Мозырский', 'Лепельский'], [['нитевидный', 'ветвистый'], [], ['кругловатый', 'у основания сросшийся', 'клиновидный расширенный черешок', 'ловчий аппарат', 'пищеварительные железы'], ['мелкий', 'одиночный', 'пазушный', 'белый венчик', 'обратнояйцевидные лепестки'], [], ['шаровидный', 'раскрывающийся', 'пятистворчатый', 'коробочка']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=51'), '1993', ['5', '8'], ['0.2', '0.4'], ['Березовский', 'Брестский', 'Дрогичинский', 'Столинский', 'Шумилинский', 'Житковичский', 'Лельчицкий', 'Петриковский', 'Светлогорский', 'Хойникский','Брагинский', 'Солигорский', 'Осиповичский', 'Кличевский', 'Житковичский', 'Лельчицкий', 'Лепельский', 'Лоевский','Петриковский'], [['укороченный'], [], ['удлиненно-обратнояйцевидный', 'клиновидно суженный' 'длинный черешок'], ['мелкий', 'обоеполый', 'правильный', 'пятимерный', 'белый'], ['негустой', 'кистевидный', 'слегка завернутый'], ['многосемянной', 'коробочка', 'удлиненные бороздки']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=52'), '1981', ['120', '200'], ['0.2', '0.35'], ['Барановичский', 'Каменецкий', 'Пружанский', 'Кореличский', 'Новогрудский', 'Свислочский', 'Клецкий', 'Копыльский', 'Столбцовский','Червенский', 'Новогрудский', 'Кореличский', 'Копыльский', 'Несвижский', 'Новогрудский', 'Свислочский'], [['прямостоячий', 'неветвистый'], ['толстый', 'деревянистый'], ['очередной', 'длинночерешковый', 'яйцевидный', 'оттянуто-заостренный', 'двоякопильчатый', 'голый', 'с рассеянными волосками'], ['желто-белый', 'мелкий', 'короткая цветоножка'], ['верхушечный', 'рыхлый', 'метелка'], ['голый', 'редкоопушенный', 'бурый', 'листовка']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=53'), '1993', ['70', '150'], ['0.4', '0.5'], ['Браславский', 'Верхнедвинский', 'Глубокский', 'Городокский', 'Мядельский'], [['молодой побег', 'рыхло-войлочно-опушенные', 'голый', 'зеленый', 'красно-бурый'], [], ['продолговато-эллиптический', 'яйцевидный', 'цельнокрайний', 'зеленый', 'рассеянно-волосистый', 'беловатый', 'войлочно-опушенный'], ['обоеполый', 'правильный', 'пятичленный', 'белый', 'светло-розовый'], ['поникающий', 'кисть'], ['ягодообразный', 'черный', 'сизый налет', 'мучнистая мякоть']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=54'), '2006', ['8', '25'], ['3', '5'], ['Брестский', 'Буда-Кошелевский', 'Быховский', 'Волковысский', 'Гомельский', 'Гродненский', 'Житковичский', 'Каменецкий', 'Клецкий', 'Минский', 'Мозырский', 'Мстиславский', 'Несвижский', 'Пружанский', 'Речицкий', 'Рогачевский', 'Слуцкий', 'Солигорский', 'Столинский', 'Глушковичский', 'Кобринский', 'Лоевский', 'Мозырьский', 'Новогрудский', 'Пинский', 'Свислочский', 'Туровский', 'Хойниковский'], [['слабый', 'разветвленный'], ['горизонтальный', 'деревянистый'], ['длинночерешковый', 'пальчато-сложный'], ['белый', 'выемчатый'], ['вильчатый', 'длинная цветоножка'], ['волосистый', 'орешек']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=55'), '1993', ['30', '60'], ['2', '4'], ['Слонимский'], [['прямостоячий', 'бороздчатый', 'краснеющий', 'сильноветвистый'], ['толстый', 'деревянистый'], ['малочисленный', 'перисто-раздельный', 'короткочерешковый', 'тройчатый', 'реснитчатый'], ['белый'], ['многоцветковый', 'метельчатый'], ['многоорешек']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=56'), '1981', ['15', '25'], ['1.5', '2.5'], ['Верхнедвинский', 'Витебский', 'Городокский', 'Полоцкий', 'Миорский', 'Поставский', 'Россонский', 'Шумилинский', 'Шарковщинский', 'Борисовский', 'Мядельский', 'Борисовский', 'Шарковщинский', 'Поставский', 'Браславский', 'Гродненский', 'Беловежская пуща', 'Налибокская пуща', 'Могилевский'], [['низкий'], ['длинный', 'ползучий'], ['округло-почковидный', 'зубчатые складчатые края'], ['однополый', 'белый', 'розоватый', 'одиночный', 'длинная цветоножка', 'тычиночный', 'пестичный'], [], ['шаровидный', 'многокостянка', 'красноватый', 'оранжево-желтый']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=57'), '1993', ['100', '400'], ['1.5', '2'], ['Брестский', 'Житковичский', 'Каменецкий', 'Ляховичский', 'Гродненский', 'Минский', 'Беловежская пуща', 'Брестский', 'Пинский', 'Слуцкий'], [['многочисленный', 'укороченный побег'], [], ['обратнояйцевидный', 'ланцетный', 'эллиптический'], ['одиночный', 'белый', 'розовый', 'короткая ножка'], [], ['шаровидный', 'мясистый', 'сизый налет', 'костянка']], text)
get_and_set_data(get_html('http://redbook.minpriroda.gov.by/plantsinfo.html?id=58'), '2006', ['60', '120'], ['1.3', '2'], ['Мозырский', 'Быховский', 'Гродненский'], [['слабый', 'ребристый', 'лазящий'], [], ['парноперистосложный', 'ветвистый усик'], [], ['рыхлый', 'пазушный', 'кисть'], ['продолговато-линейный', 'боб']], text)
template.close()
